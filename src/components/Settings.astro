---
import * as Random from "../scripts/random";
import * as Constants from "../scripts/constants";
---

<div id="settings" class="card bg-light">
  <div>
    <h3 class="card-title">⚙️ Game Settings</h3>
  </div>
  <form id="start-form">
    <div>
      <label for="total-players">👥 Total players</label>
      <input
        type="number"
        inputmode="numeric"
        id="total-players"
        class="form-control"
        name="totalPlayers"
        value="3"
        min="3"
        max={Constants.players.length.toString()}
        autocomplete="off"
      />
    </div>
    <div>
      <label for="player">👤 Avatar (must be unique)</label>
      <div class="custom-select">
        <select name="player" id="player" class="form-control" required
        ></select>
      </div>
    </div>
    <div>
      <label for="seed">🎲 Code</label>
      <input
        type="text"
        id="seed"
        class="form-control"
        name="code"
        value={Random.generateNewSeed()}
        pattern="[A-Za-z0-9]{4}"
        title="4 Characters Code"
        maxlength="4"
        autocomplete="off"
      />
    </div>
    <div>
      <label for="iteration">🔢 Round</label>
      <input
        type="number"
        inputmode="numeric"
        id="iteration"
        class="form-control"
        name="round"
        value="1"
        min="1"
        autocomplete="off"
      />
    </div>
    <button id="startButton" class="btn btn-primary"> 🏁 Start New Game</button>
  </form>
</div>

<script>
  import * as Constants from "../scripts/constants";

  const totalPlayersElement = document.getElementById(
    "total-players"
  ) as HTMLInputElement;
  totalPlayersElement.addEventListener("input", (event) =>
    populatePlayersList(parseInt((event.target as HTMLInputElement).value))
  );
  populatePlayersList(parseInt(totalPlayersElement.value));

  function populatePlayersList(playersCount: number) {
    const playerListElement = document.getElementById(
      "player"
    ) as HTMLSelectElement;
    removeOptions(playerListElement);

    const emptyOpt = document.createElement("option") as HTMLOptionElement;
    emptyOpt.value = "-1";
    playerListElement.append(emptyOpt);

    [...Array(Math.min(Constants.players.length, playersCount)).keys()]
      .map((i) => {
        const opt = document.createElement("option");
        opt.value = i.toString();
        opt.innerText = Constants.players[i];
        return opt;
      })
      .forEach((node) => playerListElement.append(node));
  }

  /**
   * Remove the Options from a Select
   */
  function removeOptions(selectElement: HTMLSelectElement) {
    for (let i = selectElement.options.length - 1; i >= 0; i--) {
      selectElement.remove(i);
    }
  }
</script>
